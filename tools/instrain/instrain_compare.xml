<tool id="instrain_compare" name="Compare" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>InStrain is a tool for analysis of co-occurring genome populations from metagenomes, Compare: compares multiple inStrain profiles (popANI, coverage_overlap, etc.) </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="edam_ontology"/>
    <expand macro="requirements"/>
    <version_command>inStrain compare --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
inStrain compare
#if $input
    --input '$input'
#end if
    --output '$output'
    --processes "\${GALAXY_SLOTS:-6}"
    --min_cov $min_cov
    --min_freq $min_freq
    --fdr $fdr
    --database_mode
    --breadth $breadth
#if $scaffolds
    --scaffolds '$scaffolds'
#end if
#if $genome
    --genome '$genome'
#end if
    --store_coverage_overlap
    --store_mismatch_locations
    --include_self_comparisons
    --skip_plot_generation
    --group_length $group_length
    --ani_threshold $ani_threshold
    --coverage_treshold $coverage_treshold
    --clusterAlg '$clusterAlg'
    ]]></command>    
    <inputs>
        <repeat name="input" title="Input">
            <param name="scaffold_info" type="data" format="tabular" label="The basic information about the scaffolds in your sample at the highest allowed level of read identity."/>            
            <param name="mapping_info" type="data" format="tabular" label="Provides an overview of the number of reads that map to each scaffold, and some basic metrics about their quality."/>            
            <param name="SNVs" type="data" format="tabular" label="Describes the SNVs and SNSs that are detected in this mapping."/>            
            <param name="gene_info" type="data" format="tabular" optional="true" label="Describes some basic information about the genes being profiled"/>
            <param name="genome_info" type="data" format="tabular" optional="true" label="Describes many of the above metrics on a genome-by-genome level, rather than a scaffold-by-scaffold level."/>
            <param name="linkage" type="data" format="tabular" label="Describes the linkage between pairs of SNPs in the mapping that are found on the same read pair at least min_snp times."/>
        </repeat>
        <section name="variant_calling" title="Variant Calling Options" expanded="true">
            <param argument="--min_cov" type="integer" value="5" label=" Minimum coverage to call an variant"/>
            <param argument="--min_freq" type="float" value="0.05" label="Minimum SNP frequency to confirm a SNV" help="Both this AND the FDR snp count cutoff must be true to call a SNP."/>
            <param argument="--fdr" type="float" value="1e-06" min="0" max="1" help="SNP false discovery rate- based on simulation data with a 0.1 percent error rate (Q30)"/>
        </section>
        <section name="database" title="Database Mode Parameters" expanded="true">
            <param argument="--database_mode" type="boolean" truevalue="--debugdatabase_mode" falsevalue="" checked="false" label="Automatically determine which genomes are present in each Profile and only compare scaffolds from those genomes." help="All profiles must have run Profile with the same .stb"/>
            <param argument="--breadth" type="float" value="0.5" label="Minimum breadth_minCov required to count a genome present"/>
        </section>
        <section name="other" title="Other Options" expanded="true">
            <param argument="--scaffolds" type="data" format="fasta" optional="true" label="Location to a list of scaffolds to compare. You can also make this a .fasta file and it will load the scaffold names"/>
            <param argument="--genome" type="data" format="fasta" optional="true" label="Run scaffolds belonging to this single genome only"/>
            <param argument="--store_coverage_overlap" type="boolean" truevalue="--store_coverage_overlap" falsevalue="" checked="false" label="Store coverage overlap on an mm level"/>
            <param argument="--store_mismatch_locations" type="boolean" truevalue="--store_mismatch_locations" falsevalue="" checked="false" label="Store the locations of SNPs"/>
            <param argument="--include_self_comparisons" type="boolean" truevalue="--include_self_comparisons" falsevalue="" checked="false" label="Compare IS profiles against themself"/>
            <param argument="--skip_plot_generation" type="boolean" truevalue="--skip_plot_generation" falsevalue="" checked="false" label="Dont create plots at the end of the run"/>
            <param argument="--group_length" type="integer" value="10000000" label="How many bp to compare simultaneously" help="higher will use more RAM and run more quickly"/>
        </section>
        <section name="genome_clustering" title="Genome Clustering Options" expanded="true">
            <param argument="--ani_threshold" type="float" value="0.99999" label="popANI threshold to cluster genomes at" help="Must provide .stb file to do so"/>
            <param argument="--coverage_treshold" type="float" value="0.1" label="Minimum percent_genome_compared for a genome comparison to count" help="if below the popANI will be set to 0"/>
            <param argument="--clusterAlg" type="select" label="Algorithm used to cluster genomes">
                <option value="average" selected="true">Average</option>
                <option value="single">Single</option>
                <option value="ward">Ward</option>
                <option value="complete">complete</option>
                <option value="centroid">centroid</option>
                <option value="weighted">weighted</option>
                <option value="median">median</option>
            </param>
        </section>
        <section name="output" title="Set Output Parameters" expanded="true">
            <param argument="--output" type="text" value="instrainComparer" label="Output prefix">
                <sanitizer invalid_char="">
                    <valid initial="string.ascii_letters,string.digits">
                        <add value="_" />
                        <add value="-" />
                    </valid>
                </sanitizer>
                <validator type="empty_field" />
            </param>
        </section>
    </inputs>
    <outputs>
        <data name="comparisonsTable" format="tabular" from_work_dir="output/comparisonsTable.tsv" label="Summarizes the differences between two inStrain profiles on a scaffold by scaffold level" >
        </data>
        <data name="pairwise_SNP_locations" format="tabular" from_work_dir="output/pairwise_SNP_locations.tsv" label="Lists the locations of all differences between profiles." >
        </data>
        <data name="genomeWide_compare" format="tabular" from_work_dir="output/genomeWide_compare.tsv" label="A genome-level summary of the differences detected by inStrain compare." >
        </data>
        <data format="tabular" name="strain_clusters" from_work_dir="output/strain_clusters.tsv" label="Generate strain-level clusters" >
        </data>
    </outputs>
    <tests>
        <test>
        </test>
    </tests>
</tool>