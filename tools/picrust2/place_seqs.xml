<tool id="picrust2_place_seqs" name="Place Seqs" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Script to run EPA-ng and GAPPA to place study sequences (i.e. OTUs or ASVs) into a reference tree. This is typically done to prep for subsequent hidden-state prediction with PICRUSt2. Requires unaligned FASTA of study sequences. Users can specify a non-default reference files if needed.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="edam_ontology"/>
    <expand macro="requirements"/>
    <version_command>place_seqs.py -v</version_command>
    <command detect_errors="exit_code"><![CDATA[
place_seqs.py
    --study_fasta '$study_fasta'
    --placement_tool '$tool'
    --ref_dir '$ref_path'
    --out_tree '$out_tree_path'
    --processes "\${GALAXY_SLOTS:-1}"
    --intermediate '$intermediate_path'
    --min_align $min_align
    --chunk_size $chunk_size
    --verbose
    ]]></command>
    <inputs>
        <param argument="--study_fasta" type="data" format="fasta" label="FASTA of unaligned study sequences"/>
        <param argument="--placement_tool" type="select" label="Placement tool to use when placing sequences into reference tree">
            <option value="epa-ng" selected="true"></option>
            <option value="sepp"></option>
        </param>
        <repeat name="ref_path" title="Reference sequence files">
            <param name="pro_ref_fna" type="data" format="fasta" label=""/>
            <param name="pro_ref_hmm" type="data" format="" label=""/>
            <param name="pro_ref_model" type="data" format="" label=""/>
            <param name="pro_ref_ramxl_info" type="data" format="" label=""/>
            <param name="pro_ref_tre" type="data" format="" label=""/>
        </repeat>
        <param argument="--out_tree" type="data" format="nhx" label="Name of final output tree."/>
        <param argument="--intermediate" type="text" format="txt" optional="true" label="Output folder for intermediate files" help="will be deleted otherwise"/>
        <param argument="--min_align" type="float" value="0.80" label="Proportion of the total length of an input query sequence that must align with reference sequences." help="Any sequences with lengths below this value after making an alignment with reference sequences will be excluded from the placement and all subsequent steps."/>
        <param argument="--chunk_size" type="integer" value="5000" label="Number of query seqs to read in at once for EPA-ng"/>
        <param argument="--verbose" type="boolean" truevalue="--verbose" falsevalue="" checked="false" label="If specified, print out wrapped commands and other details to screen."/>
   </inputs>
   <outputs>
        <data name="tree" format="tre" from_work_dir="tree.tre" label="">
        </data>
    </outputs>
 </tool>