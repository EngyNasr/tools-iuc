<tool id="picrust2_add_descriptions" name="Picrust2 Add Descriptions" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>column to a function abundance table and outputs a new file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="edam_ontology"/>
    <expand macro="requirements"/>
    <version_command>add_descriptions.py -v</version_command>
    <command detect_errors="exit_code"><![CDATA[
#set ext=$input.datatype.file_ext    
add_descriptions.py
    --input '$input'
#if $ext == 'tsv'
    --output 'added_description.tsv'
#else    
    --output 'added_description.tsv.gz'
#end if    
    --map_type '$map_type'
#if $custom_map_table    
    --custom_map_table '$custom_map_table'
#end if
#if $ext != 'tsv'
&&
gunzip *tsv.gz
#end if
    ]]></command>
    <inputs>
        <param name="input" type="data" format="tsv,tabular" label="Input function abundance table"/>
        <param argument="--map_type" type="select" label="Select which default mapping table should be used" help="one of 'METACYC', 'COG', 'EC', 'KO', 'PFAM', 'TIGRFAM'), Use the Custom Map Table option to input a non-default mapping table.">
            <option value="METACYC">METACYC</option>
            <option value="COG">COG</option>
            <option value="EC">EC</option>
            <option value="KO">KO</option>
            <option value="PFAM">PFAM</option>
            <option value="TIGRFAM">TIGRFAM</option>
        </param>
        <param name="custom_map_table" type="data" format="tsv,tabular" optional="true" label="Custom Map Table" help="An input map table linking function ids to descriptions for each function"/>
    </inputs>
    <outputs>
        <data name="func_abun_table_description" format="tsv" from_work_dir="added_description.tsv" label="Function abundance with added description">
        </data>
    </outputs>
    <tests>
    <test expect_num_outputs="1">
        <param name="input" ftype="tabular" value="pred_metagenome_unstrat.tsv.gz"/>
        <param name="map_type" value="EC"/>
        <output name="func_abun_table_description" ftype="tsv">
            <assert_contents>
                <has_text text="description"/>
                <has_n_lines n="1000"/>
            </assert_contents>
        </output>
    </test>
    </tests>
    <help><![CDATA[
@HELP_HEADER@

Add Descriptions
================
Adds a description column to a function abundance table and outputs a new file.

Note
====
The user needs to specify the input file and what type of functions are in the input table. Will throw an error if no ids overlap and otherwise will fill in "not_found" for the description of ids in the function table not in the mapfile.

Input
=====
Input function abundance table.

Output
======
Output function abundance table with added description column.
    ]]></help> 
    <citations>
        <citation type="doi">10.1038/s41587-020-0548-6</citation>
    </citations>
</tool>