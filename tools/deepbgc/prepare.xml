<tool id="deepbgc_prepare" name="DeepBGC Prepare" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Prepare genomic sequence by annotating proteins and Pfam domains</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="edam_ontology"/>
    <expand macro="requirements"/>
    <version_command>deepbgc</version_command>
    <command detect_errors="exit_code"><![CDATA[
#for $i, $s in enumerate($fasta_input)
    #if $s
        #set ext=$s.datatype.file_ext
        ln -s '$s' '$i-inputfasta.$ext' &&
    #end if
#end for 
deepbgc download &&
deepbgc prepare
#if $limit_to_record
    --limit-to-record
#end if
#for $i, $s in enumerate($limit_to_record)
    #if $s
        '$s'
    #end if
#end for
    --output-gbk 'output_gbk.gbk'
    --output-tsv 'output_tsv.tsv'
#for $i, $s in enumerate($fasta_input)
    #if $s
        #set ext=$s.datatype.file_ext
       '$i-inputfasta.$ext'
    #end if
#end for
    ]]></command>    
    <inputs>
        <param name="limit_to_record" type="text" format="txt" optional="true" multiple="true" label="Limit to record" help="Process only specific record ID. Can be provided multiple times."/>                  
        <param name="fasta_input" type="data" format="fasta,genbank" multiple="true" label="Input sequence file(s) (FASTA/GenBank)"/>
    </inputs>
    <outputs>
        <data format="tabular" name="output_tsv" from_work_dir="output_tsv.tsv" label="Output tsv file" >
            <filter>(['output-tsv'])</filter>
        </data>
        <data format="genbank" name="output_gbk" from_work_dir="output_gbk.gbk" label="Output GenBank file" >
            <filter>(['output-gbk'])</filter>
        </data>
    </outputs>
    <tests>
    <test expect_num_outputs="2">
        <param name="fasta_input" value="BGC0000015.protein.fa"/>
        <output name="output_tsv">
            <assert_contents>
                <has_n_lines n="0"/>
            </assert_contents>
        </output>
        <output name="output_gbk">
            <assert_contents>
                <has_text text="VERSION"/>
                <has_n_lines n="1059"/>                
            </assert_contents>
        </output>
    </test>
    <test expect_num_outputs="2">
        <param name="fasta_input" value="BGC0000015.fa,BGC0000015.protein.fa"/>
        <output name="output_tsv">
            <assert_contents>
                <has_text text="LOCUS"/>
                <has_n_lines n="4293"/>
            </assert_contents>
        </output>
        <output name="output_gbk">
            <assert_contents>
                <has_text text="protein_id"/>
                <has_n_lines n="148"/>
            </assert_contents>
        </output>
    </test>
    </tests>
    <help><![CDATA[
@HELP_HEADER@

Prepare
=======
Prepare genomic sequence by annotating proteins and Pfam domains.

Inputs
======
Input sequence file(s) (FASTA/GenBank)

Outputs
=======
1. Output GenBank file
2. Output TSV file

    ]]></help> 
    <citations>
        <citation type="doi">10.1093/nar/gkz654</citation>
    </citations>
</tool>