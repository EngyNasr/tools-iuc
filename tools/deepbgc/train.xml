<tool id="deepbgc_train" name="DeepBGC Train" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Train a BGC detector/classifier on a set of BGC samples</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="edam_ontology"/>
    <expand macro="requirements"/>
    <version_command>deepbgc</version_command>
    <command detect_errors="exit_code"><![CDATA[
#for $i, $s in enumerate($csv_inputs)
    #if $s
        #set ext=$s.datatype.file_ext
        ln -s '$s' 'file-$i-input.pfam.$ext' &&
    #end if
#end for 
#for $i, $s in enumerate($validation)
    #if $s
        #set ext=$s.datatype.file_ext
        ln -s '$s' 'file-$i-validation.$ext' &&
    #end if
#end for
#if $model
ln -s '$model' 'model.json' &&
#end if
#if $classes
ln -s '$classes' 'file.classes.csv' &&
#end if
#if $config
    ln -s '$config' 'config.csv' &&
#end if    
deepbgc train
#if $model
    --model 'model.json'
#end if    
#if $target
    --target '$target'
#end if    
    --output 'output.pkl'
#if $classes    
    --classes 'file.classes.csv'
#end if
#if $config
    --config '$config_text' 'config.csv'
#end if
#if $validation
    --validation '$validation'
#end if
#for $i, $s in enumerate($validation)
    #if $s
        #set ext=$s.datatype.file_ext
       'file-$i-validation.$ext'
    #end if
#end for     
#if $verbose
    --verbose $verbose
#end if
#for $i, $s in enumerate($csv_inputs)
    #if $s
        #set ext=$s.datatype.file_ext
       'file-$i-input.pfam.$ext'
    #end if
#end for    
    ]]></command>
    <inputs>
        <param name="csv_inputs" type="data" format="csv" multiple="true" label="Training sequences (Pfam TSV) file(s)"/>
        <param name="model" type="data" format="json" optional="true" label="JSON model config file"/>
        <param name="target" type="text" format="txt" optional="true" label="Target column to predict in sequence prediction"/>
        <param name="classes" type="data" format="csv,tsv" optional="true" label="Class TSV file (csv)" help="Train a sequence classifier using provided classes (binary columns), indexed by sequence_id column."/>
        <param name="config" type="data" format="csv" optional="true" label="Variables in model JSON file to replace (file)"/>        
        <param name="config_text" type="text" format="txt" value="PFAM2VEC" optional="true" label="Variables in model JSON file to replace"/>
        <param name="validation" type="data" format="csv" multiple="true" optional="true" label=" Validation sequence file(s)"/>        
        <param argument="--verbose" type="integer" optional="true" min="0" max="2" label=" Verbosity level (0=none, 1=progress bar, 2=once per epoch)"/>
    </inputs>
    <outputs>
        <data format="" name="output" from_work_dir="output.pkl" label="Output trained model file" /> 
    </outputs>
    <tests>
    <test expect_num_outputs="1">
        <param name="csv_inputs" value="BGC0000015"/>
        <param name="model" value="random_forest_test.json"/>
        <param name="classes" value="BGC0000015.classes.csv"/>
        <param name="config" value="pfam2vec.test.tsv"/>
        <param name="config_text" value="PFAM2VEC"/>
        <output name="output">
            <assert_contents>
            </assert_contents>
        </output>
    </test>
    </tests>
    <help><![CDATA[
@HELP_HEADER@

Train
=====
Train a BGC detector/classifier on a set of BGC samples.

Inputs
======
1. Classes (.csv):
   Class TSV file
2. Input training sequences (Pfam TSV) file(s)  

Outputs
=======
1. Output trained model file
2. Log file

    ]]></help> 
    <citations>
        <citation type="doi">10.1093/nar/gkz654</citation>
    </citations>
</tool>